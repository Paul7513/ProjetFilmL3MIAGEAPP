{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'movies/style2.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons/css/boxicons.min.css" rel="stylesheet">


    <title>{{ movie.title }}</title>
</head>

<body>
    <!-- Navbar -->
    <img src="{{ movie.poster_url }}" alt="Image de fond" class="background-image">
    <header class="navbar-container">
        <a href="#" class="logo">
            <i class='bx bxs-movie'></i>Movies
        </a>
        <ul class="navbar">
            <li><a href="{% url 'home' %}" class="acceuil-active">Accueil</a></li>
            <li><a href="#">Films</a></li>
            <li><a href="#">Services</a></li>
            <li><a href="#">Newsletter</a></li>
        </ul>
        <div class="recherche">
            <i class='bx bx-search-alt-2'></i>
            <input type="text" placeholder="Rechercher..." id="recherche_input">
        </div>
        <a href="{% if user.is_authenticated %}{% url 'dashboard' %}{% else %}{% url 'login' %}{% endif %}" class="connexion">Profil</a>
    </header>

    <!-- Contenu principal -->
    <div class="home-text">
        <h1>{{ movie.title }}</h1>
        <p class="description">{{ movie.synopsis }}</p>
        <div class="details">
            <h5 class="genre">{{ movie.genre }}</h5>
            <span class="vertical-bar"></span>
            <h4 class="year">{{ movie.year }}</h4>
        </div>
            <!-- Affichage des étoiles -->
            <div class="box"> 
                <div class="stars">
                    {% for star in star_rating.full %}
                        <i class="bx {{ star }}"></i> <!-- Étoile pleine -->
                    {% endfor %}
                    
                    {% for star in star_rating.half %}
                        <i class="bx {{ star }}"></i> <!-- Étoile moitié pleine -->
                    {% endfor %}
                    
                    {% for star in star_rating.empty %}
                        <i class="bx {{ star }}"></i> <!-- Étoile vide -->
                    {% endfor %}
                </div>
                <p class="average-rating">({{ rating|floatformat:1 }}/5)</p>
            </div>
              
            
           
            
    </div>

    <!-- Affichage de l'affiche du film -->
    <div class="image">
        {% if movie.poster_url %}
            <img class="film-image" src="{{ movie.poster_url }}" alt="Affiche de {{ movie.title }}">
            <!-- Icône de cœur cliquable -->
            <i class="bx bx-heart heart-icon" 
            id="heart-icon-{{ movie.id }}" 
            onclick="addToWishlist({{ movie.id }})">
        </i>

            <div class="d-flex">
                <input class="form-control text-center me-3" id="inputQuantity" type="num" value="1" style="max-width: 3rem" fdprocessedid="kg3tb">
                <button class="btn btn-add-to-cart flex-shrink-0" type="button" fdprocessedid="qy6rg">
                    <i class="bi-cart-fill me-1"></i>
                    Ajouter au panier
                </button>
            </div>
        {% else %}
            <p>Aucune affiche disponible pour ce film.</p>
        {% endif %}
        
        <span class="vertical-bar-film"> </span>
     <!-- Texte et icône à droite de la barre verticale -->
    
 
    </div>
    
    {% if related_movies %}
    <section>
        <h2 id="h2">Dans le même genre</h2>
        <i class='bx bx-chevron-left'></i>
        <i class='bx bx-chevron-right'></i>
        <div class="cards">
            {% for similar_movie in related_movies %}
                <a href="{% url 'movie_detail' similar_movie.id %}" class="card">
                    {% if similar_movie.poster_url %}
                        <img src="{{ similar_movie.poster_url }}" alt="Affiche de {{ similar_movie.title }}" class="poster">
                    {% else %}
                        <img src="path/to/default-image.jpg" alt="Image non disponible" class="poster">  <!-- Image par défaut si aucune affiche n'est disponible -->
                    {% endif %}
                </a>
            {% endfor %}
        </div>
    </section>
{% else %}
    <p>Aucun film similaire disponible.</p>
{% endif %}

    
<script>
    function addToWishlist(movieId) {
        // Effectuer l'appel AJAX vers l'URL pour ajouter à la wishlist
        fetch(`/movie/${movieId}/add_to_wishlist/`, {
            method: 'GET', // Utilise GET ou POST en fonction de ton choix
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            // Gérer la réponse JSON
            if (data.status === "success") {
                alert(data.message);  // Affiche le message de succès
                document.getElementById(`heart-icon-${movieId}`).classList.add("bxs-heart"); // Change l'icône en cœur plein
            } else {
                alert("Il y a un problème, veuillez réessayer.");
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("Une erreur s'est produite.");
        });
    }
</script>

   
</body>

</html>
